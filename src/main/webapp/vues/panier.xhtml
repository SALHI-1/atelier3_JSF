<!DOCTYPE html>
<html lang="fr"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="jakarta.faces.core"
      xmlns:h="jakarta.faces.html"
      xmlns:ui="jakarta.faces.facelets">
<f:view>
    <f:metadata>
        <f:viewAction action="#{panierBean.loadPanier}"/>
    </f:metadata>

    <h:head>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>Panier ‚Ä¢ e-Commerce</title>
        <script src="https://cdn.tailwindcss.com"></script>
    </h:head>

    <h:body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 min-h-screen">
        <ui:include src="/WEB-INF/includes/header.xhtml"/>

        <main class="max-w-6xl mx-auto px-6 py-10">
            <h1 class="text-3xl font-bold mb-10 text-center text-emerald-400 tracking-wide">
                üõí Votre panier
            </h1>

            <!-- Message si non connect√© -->
            <h:panelGroup rendered="#{empty authBean.currentUser}"
                          styleClass="bg-yellow-100/10 border border-yellow-400/30 rounded-xl p-5 mb-6 backdrop-blur-md text-center">
                <p class="text-yellow-300 font-medium">Veuillez vous connecter pour acc√©der √† votre panier.</p>
                <div class="mt-3">
                    <h:link outcome="/vues/login.xhtml"
                            styleClass="text-emerald-400 hover:text-emerald-300 underline font-semibold">Se connecter</h:link>
                </div>
            </h:panelGroup>

            <!-- Si connect√© -->
            <h:panelGroup rendered="#{not empty authBean.currentUser}">

                <!-- Panier vide -->
                <h:panelGroup rendered="#{empty panierBean.panier or empty panierBean.panier.lignes}">
                    <div class="bg-white/10 backdrop-blur-md border border-gray-700 rounded-2xl p-8 text-gray-300 text-center shadow-lg">
                        Votre panier est vide pour le moment üïäÔ∏è
                    </div>
                </h:panelGroup>

                <!-- Panier rempli -->
                <h:panelGroup rendered="#{not empty panierBean.panier and not empty panierBean.panier.lignes}">
                    <div class="bg-white/10 backdrop-blur-md border border-gray-700 rounded-2xl overflow-hidden shadow-lg">
                        <!-- En-t√™te -->
                        <div class="grid grid-cols-12 text-sm font-semibold text-gray-400 border-b border-gray-700 px-6 py-3 bg-white/5">
                            <div class="col-span-6">Produit</div>
                            <div class="col-span-2 text-right">Prix</div>
                            <div class="col-span-2 text-center">Quantit√©</div>
                            <div class="col-span-2 text-right">Sous-total</div>
                        </div>

                        <!-- Lignes du panier -->
                        <ui:repeat value="#{panierBean.panier.lignes}" var="ligne">
                            <div class="grid grid-cols-12 items-center px-6 py-4 border-b border-gray-800 last:border-b-0 hover:bg-white/5 transition">
                                <!-- Produit -->
                                <div class="col-span-6">
                                    <div class="text-lg font-semibold text-white">#{ligne.produit.nom}</div>
                                    <div class="text-gray-400 text-sm">#{ligne.produit.description}</div>
                                </div>

                                <!-- Prix -->
                                <div class="col-span-2 text-right text-emerald-400 font-medium">
                                    #{ligne.produit.prix} DH
                                </div>

                                <!-- Quantit√© -->
                                <div class="col-span-2 text-center">
                                    <h:form styleClass="inline-flex items-center justify-center gap-2">
                                        <h:inputText value="#{ligne.quantite}" size="2"
                                                     styleClass="w-16 text-center px-2 py-1 bg-gray-800 border border-gray-700 rounded text-white"/>
                                        <h:commandButton value="Maj"
                                                         action="#{panierBean.modifierQuantite(ligne)}"
                                                         styleClass="px-3 py-1 text-sm bg-gray-700 hover:bg-gray-600 rounded-md text-gray-200 transition"/>
                                    </h:form>
                                </div>

                                <!-- Sous-total + Supprimer -->
                                <div class="col-span-2 text-right">
                                    <span class="text-emerald-400 font-medium">#{ligne.sousTotal} DH</span>
                                    <h:form styleClass="inline-block ml-3">
                                        <h:commandButton value="‚úï"
                                                         action="#{panierBean.supprimerDuPanier(ligne)}"
                                                         styleClass="px-2 py-1 text-sm bg-red-600 hover:bg-red-500 text-white rounded-md transition"/>
                                    </h:form>
                                </div>
                            </div>
                        </ui:repeat>
                    </div>

                    <!-- Bas du panier -->
                    <div class="flex flex-col sm:flex-row items-center justify-between mt-8 gap-6">
                        <h:link outcome="/vues/vitrine.xhtml"
                                styleClass="text-emerald-400 hover:text-emerald-300 underline text-sm font-medium">
                            ‚Üê Continuer mes achats
                        </h:link>

                        <div class="flex items-center gap-6">
                            <div class="text-xl">
                                Total :
                                <span class="font-bold text-emerald-400">#{panierBean.panier.total} DH</span>
                            </div>
                            <h:link outcome="/vues/caisse.xhtml"
                                    styleClass="px-6 py-2 bg-emerald-500 hover:bg-emerald-400 text-white rounded-md font-semibold transition">
                                Passer √† la caisse
                            </h:link>
                        </div>
                    </div>
                </h:panelGroup>
            </h:panelGroup>
        </main>
    </h:body>
</f:view>
</html>
